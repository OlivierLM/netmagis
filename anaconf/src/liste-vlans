#!%TCLSH%

#
# $Id: liste-vlans,v 1.4 2009-01-22 20:20:21 pda Exp $
#
# Formatte la liste des vlans pour topo
#
# Syntaxe :
#	liste-vlans <fichiersrcvlan> > <fichier de sortie>
#
# Historique :
#   2004/07/09 : pda/jean      : conception
#   2007/01/08 : pda           : changement du format de sortie
#   2010/01/08 : jean/saillard : changement du format d'entree, plus de vtp
#

if {[llength $argv] != 1} {
    puts stderr "usage: $argv0 <fichier_src_vlan>"
    exit 1
}

set filename [lindex $argv 0]

if {[catch {open $filename} fd]} {
    puts stderr $fd
    exit 2
}

set format {/+. a-zA-Z0-9()<>_-}
set n 1
while {[gets $fd ligne] > -1} {
    if {[regexp "^(\[0-9\]+);(\[$format\]+)\$" $ligne bidon id desc]} then {
	binary scan $desc H* desc
	puts "vlan $id desc $desc"
    } else {
	puts -nonewline stderr "Ligne $n dans $filename : "
	puts -nonewline stderr "erreur de format dans la liste des vlans : "
	puts stderr "'$ligne' caracteres permis : '$format'"
    }
    incr n
}

exit 0
