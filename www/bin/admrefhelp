#!%TCLSH%


#
# Script d'enregistrement des modifications de tables constituant le
# référentiel de la base.
#
# Appelé par : admrefliste
#
# Paramètres (formulaire ou URL) :
#   - type : etabl, commu, hinfo, reseau, domaine, zone, zone4, zone6,
#		groupe, vlan, eq, eqtype
#   - les paramètres spécifiques de chaque type
#
# Historique
#   2010/11/17 : pda      : spécifications
#   2010/12/13 : pda/jean : add eq and eqtype tables
#

set conf(homeurl)	%HOMEURL%

#
# Chemins utilisés par les scripts
#

set conf(lib)		%DESTDIR%/lib
set conf(libdns)	$conf(lib)/libdns.tcl

#
# Définition des noms des pages "à trous"
#

set conf(err)		$conf(lib)/erreur.html
set conf(page-commu)	$conf(lib)/aidecommu.html
set conf(page-dhcpprofil)	$conf(lib)/aidedhcpprofil.html
set conf(page-domaine)	$conf(lib)/aidedomaine.html
set conf(page-etabl)	$conf(lib)/aideetabl.html
set conf(page-groupe)	$conf(lib)/aidegroupe.html
set conf(page-hinfo)	$conf(lib)/aidehinfo.html
set conf(page-reseau)	$conf(lib)/aidereseau.html
set conf(page-vlan)	$conf(lib)/aidevlan.html
set conf(page-zone)	$conf(lib)/aidezone.html
set conf(page-zone4)	$conf(page-zone)
set conf(page-zone6)	$conf(page-zone)
set conf(page-eqtype)	$conf(lib)/aideeqtype.html
set conf(page-eq)	$conf(lib)/aideeq.html

#
# Quelques paramètres du script
#

set conf(form)	{
	{type			1 1}
}

#
# Les outils du parfait concepteur de pages Web dynamiques...
#

lappend auto_path %PKGTCL%
package require webapp
package require pgsql

#
# On y va !
#

# ::webapp::cgidebug ; exit

source $conf(libdns)

##############################################################################
# Programme principal
##############################################################################

proc main {} {
    global conf

    #
    # Initialisation, avec récupération du type de modification.
    #

    ::dnscontext create d
    d init-cgi "admin" $conf(err) "admin" $conf(form) ftab dbfd login tabcor

    set type [lindex $ftab(type) 0]
    if {! [info exists conf(page-$type)]} then {
	d error "Type '$type' non supporté"
    }

    #
    # C'est fini !
    #

    d result $conf(page-$type) {}
}

::webapp::cgi-exec main %DEBUG%
