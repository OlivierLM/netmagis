
Recette pour accélérer le déroulement de rancid+topo pour permettre
la modification de conf par interface Web topo

Il faut trois spools (répertoires) différents :
    - spool des modifications à propager
    - spool des modifications effectuées
    - spool des détections de modification

Lorsqu'une modification est effectuée sur l'interface Web :

    Un fichier est généré par modification effectuée (ex: chgt
    d'affectation d'un port dans un vlan) avec une ligne :
	eq <eq> iface <iface> [vlan <vlanid>] [desc <desc en hexa>]
    Le fichier est mis dans un spool (i.e. répertoire) des modifications
    à propager.

    Lorsque la modification est propagée sur l'équipement, le fichier
    est déplacé dans un spool différent contenant les modifications
    effectuées (mais pas encore enregistrées par topo).

Lorsqu'une modification sur un équipement est détectée :

    La modification peut être soit une modification automatique
    poussée à partir de l'interface Web, soit une modification
    manuelle par un très doué ingénieur réseau.

    La détection peut-être réalisée via une trappe SNMP ou via
    l'analyse des fichiers de log. Un fichier doit être généré,
    dont le nom correspond au nom de l'équipement, dans un spool
    (différent du précédent).  La présence du fichier toto.u-strasbg.fr
    indique que l'équipement toto a été modifié.

Rancid est remplacé par le programme, constitué d'une boucle infinie
(démon), dont le corps est :

    - une fois par nuit, faire une récupération des confs (rancid original)
	et une analyse des confs (topo) complètes

    - analyser le spool de modifications à effectuer, en regroupant
	les modifications par équipement (mais en conservant la
	séquence des modifications)

	- tester si l'équipement est accessible (fping)
	    => l'idée est de ne pas attendre le timeout TCP si
		l'équipement est éteint/crashé/etc

	- propager ces modifications sur l'équipement s'il est
	    accessible (normalement, ces modifications entrainent
	    l'apparition d'une entrée dans le spool des modifications
	    détectées)

	- si la propagation s'est passée sans problème, déplacer les
	    fichiers dans le spool des modifications effectuées.

	- conserver la liste des équipements pour lesquels la
	    propagation des modifications s'est effectuée sans
	    problème.

    - analyser le spool des détections de modifications

	- si l'équipement n'est pas dans routers.db, alors râler

	- si l'équipement est accessible, alors lancer rancid pour
	    récupérer sa configuration

    - si la configuration d'un équipement a été modifiée/propagée
	avec succès, mais que cet équipement n'apparaît pas dans
	le spool des détections de modifications, alors râler

    - lancer topo en restreignant l'analyse aux seuls équipements
	modifiés

    - supprimer les fichiers du spool des modifications effectuées
